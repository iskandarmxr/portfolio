<%# Admin Analytics Dashboard %>
<% content_for :title, "Analytics" %>

<div class="page-header">
  <div class="header-left">
    <h1>Analytics</h1>
    <p class="page-subtitle">Site traffic and visitor insights</p>
  </div>
</div>

<div class="stats-grid">
  <div class="stat-card glass-card">
    <div class="stat-icon visitors">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    </div>
    <div class="stat-content">
      <span class="stat-value"><%= @stats[:unique_visitors_today] %></span>
      <span class="stat-label">Visitors Today</span>
    </div>
  </div>
  
  <div class="stat-card glass-card">
    <div class="stat-icon visitors">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    </div>
    <div class="stat-content">
      <span class="stat-value"><%= @stats[:unique_visitors_week] %></span>
      <span class="stat-label">This Week</span>
    </div>
  </div>
  
  <div class="stat-card glass-card">
    <div class="stat-icon visitors">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="20" x2="18" y2="10"/>
        <line x1="12" y1="20" x2="12" y2="4"/>
        <line x1="6" y1="20" x2="6" y2="14"/>
      </svg>
    </div>
    <div class="stat-content">
      <span class="stat-value"><%= @stats[:unique_visitors_month] %></span>
      <span class="stat-label">This Month</span>
    </div>
  </div>
  
  <div class="stat-card glass-card">
    <div class="stat-icon posts">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
    </div>
    <div class="stat-content">
      <span class="stat-value"><%= @stats[:page_views_today] %></span>
      <span class="stat-label">Page Views Today</span>
    </div>
  </div>
</div>

<div class="dashboard-grid">
  <div class="dashboard-panel glass-card">
    <div class="panel-header">
      <h2>Top Pages</h2>
    </div>
    <div class="panel-content">
      <% if @top_pages.any? %>
        <ul class="page-list">
          <% @top_pages.each do |page, views| %>
            <li class="page-item">
              <span class="page-path"><%= page %></span>
              <span class="page-views"><%= views %> views</span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <div class="empty-panel">
          <p>No page views recorded yet</p>
        </div>
      <% end %>
    </div>
  </div>
  
  <div class="dashboard-panel glass-card">
    <div class="panel-header">
      <h2>Top Referrers</h2>
    </div>
    <div class="panel-content">
      <% if @top_referrers.any? %>
        <ul class="page-list">
          <% @top_referrers.each do |referrer, count| %>
            <li class="page-item">
              <span class="page-path"><%= referrer.presence || 'Direct' %></span>
              <span class="page-views"><%= count %> visits</span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <div class="empty-panel">
          <p>No referrer data yet</p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="glass-card" style="padding: 1.5rem;">
  <h2 style="font-size: 0.875rem; font-weight: 500; margin-bottom: 1rem;">Visitors (Last 30 Days)</h2>
  <div style="height: 200px; display: flex; align-items: flex-end; gap: 4px;">
    <% max_visitors = @daily_visitors.values.max || 1 %>
    <% @daily_visitors.each do |date, count| %>
      <div 
        style="flex: 1; background: var(--primary); border-radius: 2px 2px 0 0; min-width: 8px; height: <%= (count.to_f / max_visitors * 100).round %>%;"
        title="<%= date %>: <%= count %> visitors">
      </div>
    <% end %>
    <% if @daily_visitors.empty? %>
      <p style="color: var(--text-muted); width: 100%; text-align: center;">No visitor data yet</p>
    <% end %>
  </div>
</div>
